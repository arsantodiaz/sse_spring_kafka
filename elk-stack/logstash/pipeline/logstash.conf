# Menerima input dari Filebeat
input {
  beats {
    port => 5044
  }
}

# Mem-parsing dan memperkaya data log
filter {
  # Jika log Anda memiliki format JSON, uncomment baris di bawah
  # json {
  #   source => "message"
  # }

  # Contoh filter grok untuk log umum (misal: "2023-10-27 10:30:00 INFO My message")
  # Pola ini perlu disesuaikan dengan format log Anda yang sebenarnya
  grok {
    match => { "message" => "%{TIMESTAMP_ISO8601:timestamp}\s+%{LOGLEVEL:level}\s+%{GREEDYDATA:log_message}" }
    overwrite => [ "message" ]
  }

  # Menggabungkan log multi-baris (misalnya, Java stack trace) menjadi satu event
  # Ini akan menggabungkan baris yang tidak dimulai dengan timestamp
  codec => multiline {
    pattern => "^%{TIMESTAMP_ISO8601}"
    negate => true
    what => "previous"
  }
}

# Mengirim output ke Elasticsearch
output {
  elasticsearch {
    hosts => ["http://es01:9200"]
    user => "${ELASTIC_USER}"
    password => "${ELASTIC_PASSWORD}"
    index => "logstash-%{+YYYY.MM.dd}"
  }
}
