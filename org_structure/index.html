<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organization Chart</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="tree">
        <ul id="chart-container">
            <!-- JavaScript will build the chart here -->
        </ul>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetch('structure.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Gagal memuat structure.json: " + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    const container = document.getElementById('chart-container');
                    // Mulai dari level 1
                    const rootLi = createTreeElement(data, 1);
                    container.appendChild(rootLi);
                })
                .catch(error => {
                    console.error(error);
                    const container = document.getElementById('chart-container');
                    container.innerHTML = '<p style="color: red; text-align: center;">' + error.message + '. Pastikan file ada dan format JSON benar.</p>';
                });
        });

        function createTreeElement(node, level) {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#';

            const titleSpan = document.createElement('span');
            titleSpan.className = 'node-title';
            titleSpan.textContent = node.title; 
            
            const nameSpan = document.createElement('span');
            nameSpan.className = 'node-name';
            nameSpan.textContent = node.name;

            a.appendChild(titleSpan);
            a.appendChild(nameSpan);
            li.appendChild(a);

            // --- LOGIKA COLLAPSE/EXPAND ---
            if (node.children && node.children.length > 0) {
                a.classList.add('has-children');
                const ul = document.createElement('ul');
                
                // Jika level >= 4, ciutkan (collapse) secara default
                if (level >= 4) {
                    ul.classList.add('collapsed');
                    a.classList.add('collapsed');
                }

                node.children.forEach(child => {
                    ul.appendChild(createTreeElement(child, level + 1));
                });
                li.appendChild(ul);

                a.addEventListener('click', (event) => {
                    event.preventDefault();
                    ul.classList.toggle('collapsed');
                    a.classList.toggle('collapsed');
                });
            }
            // --- AKHIR LOGIKA ---

            return li;
        }
    </script>
</body>
</html>